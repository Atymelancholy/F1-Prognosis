## Диаграмма вариантов использования


## Глоссарий

| Термин          | Определение                                                                                             |
|:----------------|:--------------------------------------------------------------------------------------------------------|
| Гость           | Неаутентифицированный пользователь приложения.                                                          |
| Пользователь    | Аутентифицированный зарегистрированный пользователь приложения.                                         |
| Администратор   | Привилегированный пользователь с правами на управление системой.                                        |
| Прогноз         | Набор предсказаний пользователя на результат конкретного Гран-при (поул, подиум, лучший круг).          |
| Гран-при (Grand Prix) | Этап чемпионата Формулы-1, на который пользователи делают прогнозы.                               |
| Рейтинг         | Таблица лидеров, отсортированная по убыванию суммы очков всех пользователей.                            |

## Поток событий
## Содержание
- [1 Актеры](#1-актеры)
- [2 Варианты использования](#2-варианты-использования)
- [2.1 Войти в свою учётную запись](#21-Войти-в-свою-учётную-запись)
- [2.2 Войти в учетную запись](#22-войти-в-учетную-запись)
- [2.3 Просмотреть календарь Гран-при](#23-посмотреть-календарь-гран-при)
- [2.4 Просмотреть рейтинг](#24-посмотреть-рейтинг)
- [2.5 Создать или отредактировать прогноз](#25-создать-или-отредактировать-прогноз)
- [2.6 Просмотреть профиль](#26-посмотреть-профиль)
- [2.7 Выйти из учетной записи](#27-выйти-из-учетной-записи)
- [2.8 Управление календарём Гран-при для администратора)](#28-Управление-календарём-Гран-при-для-администратора)
- [2.9 Внести результаты Гран-при для администратора)](#29-Внести-результаты-Гран-при-для-администратора)

## 1 Актеры
| Актер         | Описание                                                                                                                              |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------|
| Гость         | Неаутентифицированный пользователь. Может просматривать календарь и рейтинг.                                                          |
| Пользователь  | Аутентифицированный пользователь. Наследует возможности Гостя. Может управлять своими прогнозами и просматривать профиль.             |
| Администратор | Привилегированный пользователь. Наследует возможности Пользователя. Может управлять календарём и вносить результаты гонок.            |

## 2 Варианты использования
## 2.1 Войти в свою учётную запись
**Описание**. Вариант использования "Зарегистрироваться" позволяет Гостю создать новую учётную запись в системе.
**Предусловия**. Гость находится на странице аутентификации и выбрал опцию "Регистрация".
**Основной поток**.
- Система отображает форму регистрации, запрашивая email, пароль и уникальный никнейм.
- Гость вводит требуемые данные и подтверждает отправку формы.
- Система проверяет валидность email, уникальность email и никнейма в системе, а также соответствие пароля политике безопасности.
- Система создаёт новую учётную запись, хэширует пароль и автоматически аутентифицирует пользователя.
- Система перенаправляет Пользователя на главную страницу.
- Вариант использования завершается.
Альтернативный поток А1: Данные невалидны.
- Если введённые данные не проходят проверку (email не уникален, пароль слишком простой), система отображает соответствующее сообщение об ошибке.
- Возврат к п.2 основного потока.
Альтернативный поток А2: Отмена регистрации.
- Гость отменяет процесс регистрации до подтверждения.
- Система возвращает Гостя на страницу аутентификации.
- Вариант использования завершается досрочно.
**Постусловия**. Гость получает статус "Пользователь" и аутентифицирован в системе.

## 2.2 Войти в учетную запись
**Описание**. Вариант использования "Войти в учетную запись" позволяет Зарегистрированному пользователю аутентифицироваться в системе.
**Предусловия**. Пользователь находится на странице аутентификации.
**Основной поток**.
- Пользователь вводит свой email и пароль в форму входа.
- Пользователь подтверждает отправку формы.
- Система проверяет соответствие введённого пароля хэшу в базе данных.
- При успешной проверке система создаёт сессию (JWT-токен) и перенаправляет Пользователя на главную страницу.
- Вариант использования завершается.
Альтернативный поток А1: Неверные учётные данные.
- Если email или пароль неверны, система отображает общее сообщение об ошибке аутентификации.
- Возврат к п.1 основного потока.
**Постусловия**. Пользователь аутентифицирован в системе.

## 2.3 Просмотреть календарь Гран-при
**Описание**. Вариант использования позволяет Гостю или Пользователю просмотреть список предстоящих и завершённых Гран-при.
**Предусловия**. Актeр находится в приложении.
**Основной поток**.
- Актeр переходит на вкладку "Календарь".
- Система отображает список Гран-при, отсортированный по дате. Для каждого этапа отображается название, дата квалификации, дата гонки и статус (предстоящий/завершённый).
- Вариант использования завершается.

## 2.4 Просмотреть рейтинг
**Описание**. Вариант использования позволяет Гостю или Пользователю просмотреть таблицу лидеров.
**Предусловия**. Актор находится в приложении.
**Основной поток**.
- Актeр переходит на вкладку "Рейтинг".
- Система отображает таблицу, отсортированную по убыванию очков, содержащую никнеймы пользователей и сумму их очков.
- Вариант использования завершается.

## 2.5 Создать или отредактировать прогноз
**Описание**. Вариант использования позволяет Пользователю сделать или изменить прогноз на предстоящий Гран-при.
**Предусловия**. Пользователь аутентифицирован и просматривает календарь Гран-при. Время текущего сервера меньше времени начала квалификации выбранного Гран-при.
**Основной поток**.
- Пользователь выбирает предстоящий Гран-при в календаре.
- Система отображает всплывающее окно с формой для прогноза.
- Если прогноз уже существует, система предзаполняет форму текущими значениями пользователя.
- Пользователь с помощью выпадающих списков выбирает пилотов для: поул-позиции, 1-го, 2-го, 3-го мест и лучшего круга.
- Пользователь нажимает кнопку "Сохранить прогноз".
- Система проверяет, что все поля заполнены и выбранные пилоты уникальны (где требуется).
- Система сохраняет или обновляет прогноз пользователя для выбранного Гран-при.
- Система закрывает всплывающее окно.
- Вариант использования завершается.
Альтернативный поток А1: Редактирование недоступно.
- Если время квалификации уже прошло, система не позволяет открыть форму для прогноза или отображает её в режиме "только для чтения".
- Вариант использования завершается.
Альтернативный поток А2: Не все поля заполнены.
- Если пользователь пытается сохранить прогноз, не заполнив все поля, система выделяет незаполненные поля и отображает предупреждение.
- Возврат к п.4 основного потока.

## 2.6 Просмотреть профиль
**Описание**. Вариант использования позволяет Пользователю просмотреть историю своих прогнозов и набранные очки.
**Предусловия**. Пользователь аутентифицирован.
**Основной поток**.
- Пользователь переходит в свой профиль (например, кликает на свой никнейм).
- Система отображает историю прогнозов пользователя по всем Гран-при, с указанием набранных очков за каждый этап.
- Вариант использования завершается.

## 2.7 Выйти из учетной записи
**Описание**. Вариант использования позволяет Пользователю завершить сеанс работы в системе.
**Предусловия**. Пользователь аутентифицирован.
**Основной поток**.
- Пользователь нажимает кнопку "Выход" в интерфейсе приложения.
- Система инвалидирует JWT-токен пользователя.
- Система перенаправляет пользователя на страницу аутентификации.
- Вариант использования завершается.

## 2.8 Управление календарём Гран-при (Админ)
**Описание**. Вариант использования позволяет Администратору добавлять, редактировать или удалять Гран-при в календаре.
**Предусловия**. Пользователь аутентифицирован и имеет роль "Администратор".
**Основной поток**.
- Администратор переходит в панель управления в раздел "Календарь".
- Система отображает интерфейс для управления списком Гран-при.
- Администратор выбирает действие (Добавить/Изменить/Удалить).
- Администратор вводит или изменяет данные Гран-при (название, даты).
- Система сохраняет изменения.
- Вариант использования завершается.
Альтернативный поток А1: Попытка удаления Гран-при с прогнозами.
- При попытке удалить Гран-при, на который уже есть прогнозы пользователей, система отклоняет операцию и уведомляет администратора.
- Вариант использования завершается.

## 2.9 Внести результаты Гран-при (Админ)
**Описание**. Вариант использования позволяет Администратору внести фактические результаты завершённого Гран-при для подсчёта очков.
**Предусловия**. Пользователь аутентифицирован и имеет роль "Администратор". Гран-при помечен как завершённый.
**Основной поток**.
- Администратор переходит в панель управления и выбирает завершённый Гран-при.
- Система отображает форму для ввода результатов: поул-позиция, 1-е, 2-е, 3-е места, лучший круг.
- Администратор вносит результаты и подтверждает сохранение.
- Система запускает фоновый процесс подсчёта очков для всех прогнозов, связанных с этим Гран-при.
- Система обновляет общий рейтинг всех пользователей.
- Вариант использования завершается.
**Постусловия**. Очки всех пользователей, сделавших прогноз на этот Гран-при, обновлены.



















